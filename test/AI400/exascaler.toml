version = "2025082800"

[global]
name = "aifs"
id = "c96e63f4-7066-43b5-b50d-4b27533641dd"
ntp_list = ["ntp.aliyun.com", "time1.cloud.tencent.com"]
multitenancy = true

[global.mgt]
list = ["ai400-vm00", "ai400-vm01", "ai400-vm02", "ai400-vm03"]
size = "2G"
mount_opts = "max_sectors_kb=0"
device_path = "/dev/ddn"
mmp_interval = "5s"
failback = true

[sfa.AI400]
controllers = ["192.168.137.135", "192.168.137.136"]

[HA]
groups = [["ai400-vm00", "ai400-vm01", "ai400-vm02", "ai400-vm03"]]
ifspeed = true
pingd = true
secauth = true
start_on_boot = true

[fs.aifs.mdt]
list = ["ai400-vm00", "ai400-vm01", "ai400-vm02", "ai400-vm03"]
mke2fs_opts = "-m1 -E lazy_itable_init=0,lazy_journal_init=0,nodiscard -O project"
mount_opts = "max_sectors_kb=0"
device_path = "/dev/ddn"
failback = true

[fs.aifs.ost]
list = ["ai400-vm00", "ai400-vm01", "ai400-vm02", "ai400-vm03"]
mke2fs_opts = "-m1 -i 131072 -E lazy_itable_init=0,lazy_journal_init=0,nodiscard -O project"
mke2fs_opts_conditional = [
  "for size > 128000000000000 apply '-E lazy_itable_init=1,nodiscard -N 1073741824 -O project'",
]
mount_opts = "max_sectors_kb=0"
device_path = "/dev/ddn"
mmp_interval = "5s"
failback = true

[host_defaults]
grub_args = "spectre_v2=off nopti"

[host_defaults.stonith]
type = "sfa_vm"
timeout = "5m"

[set_param_tunings]
jobid_name = "%j:%u:%h"
jobid_var = "SLURM_JOB_ID"
'llite.*.max_read_ahead_mb' = 2048
'obdfilter.*.brw_size' = 16
'osc.*.max_dirty_mb' = 512
'osc.*.max_pages_per_rpc' = "16M"
'osc.*.max_rpcs_in_flight' = 8
'osd-ldiskfs.*.read_cache_enable' = 0
'osd-ldiskfs.*.writethrough_cache_enable' = 0
'osd-*.aifs*.quota_slave_md.enabled' = "ugp"
'osd-*.aifs*.quota_slave_dt.enabled' = "ugp"
'osd-ldiskfs.*.quota_slave.root_prj_enable' = 1
'osd*.*.quota_slave.enabled' = "ugp"

[host.ai400-vm00]
corosync_links = ["mgmt0", "mlxib0"]
lnets = ["o2ib0(mlxib0,mlxib1)"]
oid = "0x10000000"
sfa = "AI400"

[host.ai400-vm00.overrides]
peers = ["ai400-vm01", "ai400-vm02", "ai400-vm03"]

[host.ai400-vm00.fs.aifs]
mdt_list = [0]
ost_list = [0, 1]

[host.ai400-vm00.nic.mgmt0]
type = "ethernet"
ip = "192.168.137.61"
method = "manual"
netmask = "255.255.255.0"
gateway = "192.168.137.1"
dad_timeout = 3000

[host.ai400-vm00.nic.mgmt0.cfg.ipv4]
dns = "8.8.8.8"

[host.ai400-vm00.nic.mlxib0]
type = "infiniband"
ip = "192.168.0.61"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm00.nic.mlxib1]
type = "infiniband"
ip = "192.168.0.161"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm00.sysctl]
"net.ipv4.conf.all.arp_announce" = 2
"net.ipv4.conf.all.arp_ignore" = 1
"net.ipv4.conf.all.rp_filter" = 0
"net.ipv4.conf.default.arp_announce" = 2
"net.ipv4.conf.default.arp_ignore" = 1
"net.ipv4.conf.default.rp_filter" = 2
"vm.min_free_kbytes" = 2097152

[host.ai400-vm01]
corosync_links = ["mgmt0", "mlxib0"]
lnets = ["o2ib0(mlxib0,mlxib1)"]
oid = "0x10008000"
sfa = "AI400"

[host.ai400-vm01.overrides]
peers = ["ai400-vm00", "ai400-vm03", "ai400-vm02"]

[host.ai400-vm01.fs.aifs]
mdt_list = [1]
ost_list = [2, 3]

[host.ai400-vm01.nic.mgmt0]
type = "ethernet"
ip = "192.168.137.62"
method = "manual"
netmask = "255.255.255.0"
gateway = "192.168.137.1"
dad_timeout = 3000

[host.ai400-vm01.nic.mgmt0.cfg.ipv4]
dns = "8.8.8.8"

[host.ai400-vm01.nic.mlxib0]
type = "infiniband"
ip = "192.168.0.62"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm01.nic.mlxib1]
type = "infiniband"
ip = "192.168.0.162"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm01.sysctl]
"net.ipv4.conf.all.arp_announce" = 2
"net.ipv4.conf.all.arp_ignore" = 1
"net.ipv4.conf.all.rp_filter" = 0
"net.ipv4.conf.default.arp_announce" = 2
"net.ipv4.conf.default.arp_ignore" = 1
"net.ipv4.conf.default.rp_filter" = 2
"vm.min_free_kbytes" = 2097152

[host.ai400-vm02]
corosync_links = ["mgmt0", "mlxib0"]
lnets = ["o2ib0(mlxib0,mlxib1)"]
oid = "0x10000001"
sfa = "AI400"

[host.ai400-vm02.overrides]
peers = ["ai400-vm03", "ai400-vm00", "ai400-vm01"]

[host.ai400-vm02.fs.aifs]
mdt_list = [2]
ost_list = [4, 5]

[host.ai400-vm02.nic.mgmt0]
type = "ethernet"
ip = "192.168.137.63"
method = "manual"
netmask = "255.255.255.0"
gateway = "192.168.137.1"
dad_timeout = 3000

[host.ai400-vm02.nic.mgmt0.cfg.ipv4]
dns = "8.8.8.8"

[host.ai400-vm02.nic.mlxib0]
type = "infiniband"
ip = "192.168.0.63"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm02.nic.mlxib1]
type = "infiniband"
ip = "192.168.0.163"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm02.sysctl]
"net.ipv4.conf.all.arp_announce" = 2
"net.ipv4.conf.all.arp_ignore" = 1
"net.ipv4.conf.all.rp_filter" = 0
"net.ipv4.conf.default.arp_announce" = 2
"net.ipv4.conf.default.arp_ignore" = 1
"net.ipv4.conf.default.rp_filter" = 2
"vm.min_free_kbytes" = 2097152

[host.ai400-vm03]
corosync_links = ["mgmt0", "mlxib0"]
lnets = ["o2ib0(mlxib0,mlxib1)"]
oid = "0x10008001"
sfa = "AI400"

[host.ai400-vm03.overrides]
peers = ["ai400-vm02", "ai400-vm01", "ai400-vm00"]

[host.ai400-vm03.fs.aifs]
mdt_list = [3]
ost_list = [6, 7]

[host.ai400-vm03.nic.mgmt0]
type = "ethernet"
ip = "192.168.137.64"
method = "manual"
netmask = "255.255.255.0"
gateway = "192.168.137.1"
dad_timeout = 3000

[host.ai400-vm03.nic.mgmt0.cfg.ipv4]
dns = "8.8.8.8"

[host.ai400-vm03.nic.mlxib0]
type = "infiniband"
ip = "192.168.0.64"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm03.nic.mlxib1]
type = "infiniband"
ip = "192.168.0.164"
method = "manual"
netmask = "255.255.255.0"
dad_timeout = 3000

[host.ai400-vm03.sysctl]
"net.ipv4.conf.all.arp_announce" = 2
"net.ipv4.conf.all.arp_ignore" = 1
"net.ipv4.conf.all.rp_filter" = 0
"net.ipv4.conf.default.arp_announce" = 2
"net.ipv4.conf.default.arp_ignore" = 1
"net.ipv4.conf.default.rp_filter" = 2
"vm.min_free_kbytes" = 2097152

[EMF]
ip = "192.168.137.69"
nic = "mgmt0"
size = "80.0GiB"

[EMF.health]
group = ["ai400-vm00", "ai400-vm01", "ai400-vm02", "ai400-vm03"]
scrape_interval = 20
evaluation_interval = 20

[[EMF.health.notification.msteams.configs]]
api_url = "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=ddbc90af-8060-4eb6-8380-3a44fe371041"
